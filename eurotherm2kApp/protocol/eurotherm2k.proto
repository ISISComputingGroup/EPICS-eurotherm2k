## \file
## Stream Device Protocol for eurotherm 2000 series EI Bisynch
## will look for the record \$1ERR which will process any errors

locktimeout = 5000;

OutTerminator   = "";
replytimeout = 200;
readtimeout  = 200;
extrainput   = Ignore;

#STX = "\x02"
#ETX = "\x03"
#EOT = "\x04"
#ENQ = "\x05"
#ACK = "\x06"

## Read value
## \code
## send: [EOT](GAD)(GAD)(LAD)(LAD)(CHAN)(C1)(C2)[ENQ]
## reply: [STX](CHAN)(C1)(C2)<DATA>[ETX](BCC)
## \endcode
## - $1 = device prefix, \$(P)
## - $2 = command mnemonic
## - $3 = GAD = First char of address, e.g. address = 1, GAD = 0, address = 12, GAD = 1
## - $4 = LAD = Second char of address, e.g. address = 1, LAD = 1, address = 12, LAD = 2
#############################################################################
read { InTerminator = ""; out "\x04\$3\$3\$4\$4\$2\x05"; in "\x02\$2%f\x03%*c"; }

## Read value, but in hex
readhex { InTerminator = ""; out "\x04\$3\$3\$4\$4\$2\x05"; in "\x02\$2>%x\x03%*c"; }

## Write value
## \code
## send: [EOT](GAD)(GAD)(LAD)(LAD)[STX](CHAN)(C1)(C2)<DATA>[ETX](BCC)
## reply: [ACK] or [NAK], discarded as no terminator
## \endcode
## - $1 = device prefix, \$(P)
## - $2 = command mnemonic
## - $3 = GAD = First char of address, e.g. address = 1, GAD = 0, address = 12, GAD = 1
## - $4 = LAD = Second char of address, e.g. address = 1, LAD = 1, address = 12, LAD = 2

#############################################################################
write {  InTerminator = ""; out "\x04\$3\$3\$4\$4\x02\$2%f\x03%6<xor>"; in "\x06"; @init{ read; }; @mismatch{ in "%(\$1ERR.PROC)r"; }; }

## Write a value in int rather than float
writeint {  InTerminator = ""; out "\x04\$3\$3\$4\$4\x02\$2%i\x03%6<xor>"; in "\x06"; @init{ read; }; @mismatch{ in "%(\$1ERR.PROC)r"; }; }
